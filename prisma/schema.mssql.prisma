generator client {
  provider = "prisma-client-js"
  output   = "../prisma-clients/mssql"
}

datasource db {
  provider = "sqlserver"
  url      = env("DATABASE_URL_MSSQL")
}

model guns {
  id               Int           @id(map: "PK__guns__3213E83FF693C421") @default(autoincrement())
  connector        String?       @db.NVarChar(45)
  cpid             String?       @db.NVarChar(255)
  cpsn             String?       @db.NVarChar(255)
  guns_status      String?       @db.NVarChar(45)
  createdAt        DateTime?     @db.Date
  updatedAt        DateTime?     @db.Date
  guns_metervalue1 String?       @db.NVarChar(255)
  guns_metervalue2 String?       @db.NVarChar(255)
  guns_metervalue3 String?       @db.NVarChar(255)
  guns_metervalue4 String?       @db.NVarChar(255)
  guns_metervalue5 String?       @db.NVarChar(255)
  guns_metervalue6 String?       @db.NVarChar(255)
  guns_memo1       String?       @db.NVarChar(255)
  guns_memo2       String?       @db.NVarChar(255)
  transactionid    String?       @db.NVarChar(255)
  acdc             String?       @default("N'AC'", map: "DF__guns__acdc__4F7CD00D") @db.NVarChar(2)
  max_kw           Int?          @default(0, map: "DF__guns__max_kw__5070F446")
  meter_id         Int?
  gun_tariffs      gun_tariffs[]
  meter            meters?       @relation("meter_guns", fields: [meter_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "FK_guns_meter")

  @@index([acdc], map: "IX_guns_acdc")
  @@index([connector], map: "IX_guns_connector")
  @@index([cpid], map: "IX_guns_cpid")
  @@index([cpsn], map: "IX_guns_cpsn")
  @@index([guns_status], map: "IX_guns_guns_status")
  @@index([meter_id], map: "IX_guns_meter_id")
}

model stations {
  id           Int      @id(map: "PK__stations__3213E83FA9A30629") @default(autoincrement())
  station_code String   @unique(map: "UQ_stations_station_code") @db.NVarChar(50)
  name         String?  @db.NVarChar(100)
  address      String?  @db.NVarChar(255)
  floor        String?  @db.NVarChar(50)
  operator_id  String?  @db.NVarChar(50)
  updated_at   DateTime @default(now(), map: "DF__stations__update__45F365D3")
  meters       meters[] @relation("station_meters")
}

model meters {
  id           Int      @id(map: "PK__meters__3213E83F94ABA4E4") @default(autoincrement())
  station_id   Int
  meter_no     String   @db.NVarChar(50)
  ems_mode     String   @default("N'static'", map: "DF__meters__ems_mode__49C3F6B7") @db.NVarChar(32)
  max_power_kw Decimal  @default(480.00, map: "DF__meters__max_powe__4AB81AF0") @db.Decimal(10, 2)
  billing_mode String?  @db.NVarChar(32)
  owner_id     String?  @db.NVarChar(50)
  updated_at   DateTime @default(now(), map: "DF__meters__updated___4BAC3F29")
  guns         guns[]   @relation("meter_guns")
  station      stations @relation("station_meters", fields: [station_id], references: [id], onDelete: Cascade, map: "FK_meters_station")

  @@unique([station_id, meter_no], map: "UQ_station_meter")
  @@index([billing_mode], map: "IX_meters_billing_mode")
  @@index([meter_no], map: "IX_meters_meter_no")
  @@index([owner_id], map: "IX_meters_owner_id")
  @@index([station_id], map: "IX_meters_station_id")
}

model tariffs {
  id                    Int           @id(map: "PK__tariffs__3213E83FE6F01567") @default(autoincrement())
  name                  String        @db.NVarChar(100)
  description           String?       @db.NVarChar(Max)
  tariff_type           String        @default("N'FIXED_RATE'", map: "DF__tariffs__tariff___37A5467C") @db.NVarChar(20)
  base_price            Decimal       @db.Decimal(10, 2)
  charging_parking_fee  Decimal?      @db.Decimal(10, 2)
  peak_hours_start      String?       @db.NVarChar(5)
  peak_hours_end        String?       @db.NVarChar(5)
  peak_hours_price      Decimal?      @db.Decimal(10, 2)
  off_peak_price        Decimal?      @db.Decimal(10, 2)
  weekend_price         Decimal?      @db.Decimal(10, 2)
  tier1_max_kwh         Decimal?      @db.Decimal(10, 2)
  tier1_price           Decimal?      @db.Decimal(10, 2)
  tier2_max_kwh         Decimal?      @db.Decimal(10, 2)
  tier2_price           Decimal?      @db.Decimal(10, 2)
  tier3_price           Decimal?      @db.Decimal(10, 2)
  discount_percentage   Decimal?      @db.Decimal(5, 2)
  promotion_code        String?       @db.NVarChar(50)
  valid_from            DateTime?
  valid_to              DateTime?
  season_start_month    Int?          @db.TinyInt
  season_end_month      Int?          @db.TinyInt
  season_type           String        @default("N'ALL_YEAR'", map: "DF__tariffs__season___398D8EEE") @db.NVarChar(20)
  grace_period_minutes  Int?
  penalty_rate_per_hour Decimal?      @db.Decimal(10, 2)
  ac_only               Boolean       @default(false, map: "DF__tariffs__ac_only__3B75D760")
  dc_only               Boolean       @default(false, map: "DF__tariffs__dc_only__3C69FB99")
  membership_required   Boolean       @default(false, map: "DF__tariffs__members__3D5E1FD2")
  is_active             Boolean       @default(true, map: "DF__tariffs__is_acti__3E52440B")
  is_default            Boolean       @default(false, map: "DF__tariffs__is_defa__3F466844")
  created_by            String?       @db.NVarChar(100)
  createdAt             DateTime      @default(now(), map: "DF__tariffs__created__403A8C7D")
  updatedAt             DateTime      @default(now(), map: "DF__tariffs__updated__412EB0B6") @updatedAt
  gun_tariffs           gun_tariffs[]

  @@index([is_active], map: "IX_tariffs_is_active")
  @@index([is_default], map: "IX_tariffs_is_default")
  @@index([name], map: "IX_tariffs_name")
  @@index([tariff_type], map: "IX_tariffs_tariff_type")
}

model gun_tariffs {
  id        Int      @id(map: "PK__gun_tari__3213E83FA051E2DB") @default(autoincrement())
  gun_id    Int
  tariff_id Int
  priority  Int?     @default(1, map: "DF__gun_tarif__prior__5629CD9C")
  is_active Boolean  @default(true, map: "DF__gun_tarif__is_ac__571DF1D5")
  createdAt DateTime @default(now(), map: "DF__gun_tarif__creat__5812160E")
  updatedAt DateTime @default(now(), map: "DF__gun_tarif__updat__59063A47")
  guns      guns     @relation(fields: [gun_id], references: [id], onDelete: Cascade, map: "FK_gun_tariffs_gun")
  tariffs   tariffs  @relation(fields: [tariff_id], references: [id], onDelete: Cascade, map: "FK_gun_tariffs_tariff")

  @@unique([gun_id, tariff_id], map: "UQ_gun_tariff")
  @@index([gun_id], map: "IX_gun_tariffs_gun_id")
  @@index([is_active], map: "IX_gun_tariffs_is_active")
  @@index([priority], map: "IX_gun_tariffs_priority")
  @@index([tariff_id], map: "IX_gun_tariffs_tariff_id")
}
