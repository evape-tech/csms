generator client {
  provider = "prisma-client-js"
  output   = "../prisma-clients/mssql"
}

datasource db {
  provider = "sqlserver"
  url      = env("DATABASE_URL_MSSQL")
}

model cp_logs {
  id        BigInt    @id(map: "PK__cp_logs__3213E83FE0AD6BAB") @default(autoincrement())
  cpid      String?   @db.NVarChar(255)
  cpsn      String?   @db.NVarChar(255)
  log       String?   @db.NVarChar(Max)
  inout     String?   @db.NVarChar(45)
  time      DateTime?
  createdAt DateTime?
  updatedAt DateTime?
}

model guns {
  id               Int       @id(map: "PK__guns__3213E83FF2EC5AB1") @default(autoincrement())
  connector        String?   @db.NVarChar(45)
  cpid             String?   @db.NVarChar(255)
  cpsn             String?   @db.NVarChar(255)
  guns_status      String?   @db.NVarChar(45)
  createdAt        DateTime? @db.Date
  updatedAt        DateTime? @db.Date
  guns_metervalue1 String?   @db.NVarChar(255)
  guns_metervalue2 String?   @db.NVarChar(255)
  guns_metervalue3 String?   @db.NVarChar(255)
  guns_metervalue4 String?   @db.NVarChar(255)
  guns_metervalue5 String?   @db.NVarChar(255)
  guns_metervalue6 String?   @db.NVarChar(255)
  guns_memo1       String?   @db.NVarChar(255)
  guns_memo2       String?   @db.NVarChar(255)
  transactionid    String?   @db.NVarChar(255)
  acdc             String?   @default("N'AC'", map: "DF__guns__acdc__4D94879B") @db.NVarChar(2)
  max_kw           Int?      @default(0, map: "DF__guns__max_kw__4E88ABD4")
  meter_id         Int?
  meter            meters?   @relation("meter_guns", fields: [meter_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "FK_guns_meter")
}

model stations {
  id           Int      @id(map: "PK__stations__3213E83F8C9E4FC5") @default(autoincrement())
  station_code String   @unique(map: "UQ_stations_station_code") @db.NVarChar(50)
  name         String?  @db.NVarChar(100)
  address      String?  @db.NVarChar(255)
  floor        String?  @db.NVarChar(50)
  operator_id  String?  @db.NVarChar(50)
  tariff_id    Int?
  updated_at   DateTime @default(now(), map: "DF__stations__update__4316F928")
  meters       meters[] @relation("station_meters")
  tariff       tariffs? @relation("StationTariff", fields: [tariff_id], references: [id], map: "FK_stations_tariff")

  @@index([name], map: "IX_stations_name")
  @@index([operator_id], map: "IX_stations_operator_id")
}

model meters {
  id           Int      @id(map: "PK__meters__3213E83F2279467A") @default(autoincrement())
  station_id   Int
  meter_no     String   @db.NVarChar(50)
  ems_mode     String   @default("N'static'", map: "DF__meters__ems_mode__47DBAE45") @db.NVarChar(32)
  max_power_kw Decimal  @default(480.00, map: "DF__meters__max_powe__48CFD27E") @db.Decimal(10, 2)
  billing_mode String?  @db.NVarChar(32)
  owner_id     String?  @db.NVarChar(50)
  updated_at   DateTime @default(now(), map: "DF__meters__updated___49C3F6B7")
  guns         guns[]   @relation("meter_guns")
  station      stations @relation("station_meters", fields: [station_id], references: [id], onDelete: Cascade, map: "FK_meters_station")

  @@unique([station_id, meter_no], map: "UQ_station_meter")
  @@index([billing_mode], map: "IX_meters_billing_mode")
  @@index([meter_no], map: "IX_meters_meter_no")
  @@index([owner_id], map: "IX_meters_owner_id")
  @@index([station_id], map: "IX_meters_station_id")
}

model users {
  id        Int      @id(map: "PK__users__3213E83F6AF24666") @default(autoincrement())
  email     String?  @db.NVarChar(255)
  password  String?  @db.NVarChar(255)
  role      String?  @db.NVarChar(255)
  createdAt DateTime
  updatedAt DateTime
}

model transactions {
  id                BigInt    @id(map: "PK__transact__3213E83F6FAE4EE5") @default(autoincrement())
  transaction_id    String    @unique(map: "UQ__transact__85C600AE71C0990A") @db.NVarChar(50)
  start_time        DateTime
  end_time          DateTime?
  cpid              String    @db.NVarChar(255)
  cpsn              String    @db.NVarChar(255)
  connector_id      Int
  user_id           String?   @db.NVarChar(100)
  id_tag            String    @db.NVarChar(20)
  meter_start       Decimal?  @db.Decimal(10, 3)
  meter_stop        Decimal?  @db.Decimal(10, 3)
  energy_consumed   Decimal?  @db.Decimal(10, 3)
  current_power     Decimal?  @db.Decimal(8, 3)
  current_voltage   Decimal?  @db.Decimal(8, 2)
  current_current   Decimal?  @db.Decimal(8, 2)
  last_meter_update DateTime?
  charging_duration Int?
  status            String    @default("N'ACTIVE'", map: "DF__transacti__statu__5535A963") @db.NVarChar(20)
  stop_reason       String?   @db.NVarChar(100)
  createdAt         DateTime
  updatedAt         DateTime

  @@index([cpid], map: "IX_transactions_cpid")
  @@index([cpsn], map: "IX_transactions_cpsn")
  @@index([end_time], map: "IX_transactions_end_time")
  @@index([id_tag], map: "IX_transactions_id_tag")
  @@index([start_time], map: "IX_transactions_start_time")
  @@index([status], map: "IX_transactions_status")
  @@index([transaction_id], map: "IX_transactions_transaction_id")
}

model tariffs {
  id                  Int        @id(map: "PK__tariffs__3213E83F0793228A") @default(autoincrement())
  name                String     @db.NVarChar(100)
  description         String?    @db.NVarChar(Max)
  tariff_type         String     @default("N'FIXED_RATE'", map: "DF__tariffs__tariff___37A5467C") @db.NVarChar(20)
  base_price          Decimal    @db.Decimal(10, 2)
  service_fee         Decimal?   @db.Decimal(10, 2)
  minimum_fee         Decimal?   @db.Decimal(10, 2)
  peak_hours_start    String?    @db.NVarChar(5)
  peak_hours_end      String?    @db.NVarChar(5)
  peak_hours_price    Decimal?   @db.Decimal(10, 2)
  off_peak_price      Decimal?   @db.Decimal(10, 2)
  weekend_price       Decimal?   @db.Decimal(10, 2)
  tier1_max_kwh       Decimal?   @db.Decimal(10, 2)
  tier1_price         Decimal?   @db.Decimal(10, 2)
  tier2_max_kwh       Decimal?   @db.Decimal(10, 2)
  tier2_price         Decimal?   @db.Decimal(10, 2)
  tier3_price         Decimal?   @db.Decimal(10, 2)
  discount_percentage Decimal?   @db.Decimal(5, 2)
  promotion_code      String?    @db.NVarChar(50)
  valid_from          DateTime?
  valid_to            DateTime?
  ac_only             Boolean    @default(false, map: "DF__tariffs__ac_only__398D8EEE")
  dc_only             Boolean    @default(false, map: "DF__tariffs__dc_only__3A81B327")
  membership_required Boolean    @default(false, map: "DF__tariffs__members__3B75D760")
  is_active           Boolean    @default(true, map: "DF__tariffs__is_acti__3C69FB99")
  is_default          Boolean    @default(false, map: "DF__tariffs__is_defa__3D5E1FD2")
  created_by          String?    @db.NVarChar(100)
  createdAt           DateTime   @default(now(), map: "DF__tariffs__created__3E52440B")
  updatedAt           DateTime   @default(now(), map: "DF__tariffs__updated__3F466844") @updatedAt
  stations            stations[] @relation("StationTariff")

  @@index([is_active], map: "IX_tariffs_is_active")
  @@index([is_default], map: "IX_tariffs_is_default")
  @@index([name], map: "IX_tariffs_name")
  @@index([tariff_type], map: "IX_tariffs_tariff_type")
}

model billing_channels {
  id        Int      @id(map: "PK__billing___3213E83FE18A5F69") @default(autoincrement())
  name      String   @db.NVarChar(50)
  code      String   @unique(map: "UQ__billing___357D4CF90730AA3F") @db.NVarChar(30)
  status    Int      @default(1, map: "DF__billing_c__statu__59FA5E80") @db.TinyInt
  config    String?  @db.NVarChar(Max)
  createdAt DateTime @default(now(), map: "DF__billing_c__creat__5AEE82B9")
  updatedAt DateTime @default(now(), map: "DF__billing_c__updat__5BE2A6F2")
}
